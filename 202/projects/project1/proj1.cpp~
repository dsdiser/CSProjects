/*****************************************
 ** File:    proj1.cpp
 ** Project: CMSC 202 Project 1, Spring 2017
 ** Author:  Daniel Diseroad
 ** Date:    2/10/17
 ** Section: 22
 ** E-mail:  ddiser1@umbc.edu 
 **
 ** This file contains the game "Manhunt," where an
 ** investigator tries to find a fugitive from the
 ** law. The game has the ability to read from a file
 ** and includes the use of arrays.
 **
 ***********************************************/
#include <iostream>
#include <cstdlib>
#include <fstream>
#include <string>

using namespace std;

const int ROWS_COLUMNS = 10;

void startMenu();
void newMap();
void printMap(char board[][ROWS_COLUMNS]);
void loadFile();
void mainMenu(char board[][ROWS_COLUMNS],int investPositionX,int investPositionY,
	      int targetPositionX, int targetPositionY);
bool checkSearch(int investPositionX, int investPositionY);
bool checkWin(int investPositionX, int investPositionY,int targetPositionX,
	      int targetPositionY);
void recommendation(int investPositionX, int investPositionY,int targetPositionX,
		     int targetPositionY);

int main() 
{
  startMenu();
  return 0;
}

void startMenu()
{
//Beginning menu
  cout << "Manhunt" << endl;
  cout << "What would you like to do?\n1. Load a simulation from file" << endl;
  cout << "2. Start a new simulation\n3. Exit" << endl;
  int choice = 0;
//Validating user input
  while(choice<1 or choice>3)
  {
      cout << "Enter 1 - 3:" << endl;
      cin >> choice;
      if (cin.peek() == '\n')
	cin.ignore();
  }
//Cases lead to different function calls, either loading from a file, making a new map, or
//quitting the program
  switch(choice)
  {
    case 1:
      loadFile();
      break;
    case 2:
      newMap();
      break;
    case 3:
      cout << "Giving up so soon?\nGoodbye." << endl;
      break;
  }
}

void newMap()
{
//Creates map of underscores in a 2D array
  char board[ROWS_COLUMNS][ROWS_COLUMNS];
  for(int i=0; i<ROWS_COLUMNS; i++)
    for(int j = 0; j<ROWS_COLUMNS; j++)
      board[i][j] = '_';
//Initialization for variables for investigator and target position
  int xInvest = 11;
  int yInvest = 11;
  int xTarget = 11;
  int yTarget = 11;
//Input for positions of the investigator and target and input validation
  while((xInvest > 9 or xInvest < 0) or (yInvest > 9 or 
	 yInvest < 0) or (xTarget > 9 or xTarget < 0) or 
	 (yTarget > 9 or yTarget < 0))
  {
    cout << "What is the X axis of the investigator?:" << endl;
    cin >> xInvest;
    cout << "What is the Y axis of the investigator?:" << endl;
    cin >> yInvest;
    cout << "What is the X axis of the target?:" << endl;
    cin >> xTarget;
    cout << "What is the Y axis of the target?:" << endl;
    cin >> yTarget;
  }
//Inputs the target and investigator positions into the board
  board[yInvest][xInvest] = 'I';
  board[yTarget][xTarget] = 'T';
//Starts the main menu function with the board and investigator position
  mainMenu(board,xInvest,yInvest,xTarget,yTarget);
}

void printMap(char board[][ROWS_COLUMNS])
{
//Prints out each char in array one by one, 
//making a new line when the row is done
  for(int i = 0; i<ROWS_COLUMNS; i++)
  {
    for(int j = 0; j<ROWS_COLUMNS;j++)
//Prints out a "_" instead of a T so the user doesn't know where the target is
      if(board[i][j] != 'T')
	cout << board[i][j] << " ";
      else
	cout << '_' << " ";
    cout << endl;
  }
}

void loadFile()
{
//Initializes inputstream and asks the user for the name of the text file
  ifstream inputStream;
  string fileName;
  cout << "What is the name of the file?" << endl;
  getline(cin,fileName);
  inputStream.open(fileName.c_str());
  int xInvest, yInvest, xTarget, yTarget;
//Gathers the x and y coordinates of the investigator and target
  inputStream >> xInvest;
  inputStream >> yInvest;
  inputStream >> xTarget;
  inputStream >> yTarget;
//Makes the new board and inputs the targets
  char board[ROWS_COLUMNS][ROWS_COLUMNS];
  for(int i=0; i<ROWS_COLUMNS; i++)
    for(int j = 0; j<ROWS_COLUMNS; j++)
      board[i][j] = '_';
//Places icons where the investigator and target are
  board[yInvest][xInvest] = 'I';
  board[yTarget][xTarget] = 'T';
//Starts the main menu function with the board and investigator position
  cout << "Map loaded" << endl;
  inputStream.close();
  mainMenu(board,xInvest,yInvest,xTarget,yTarget);
}

void mainMenu(char board[][ROWS_COLUMNS],int investPositionX, int investPositionY,
	      int targetPositionX, int targetPositionY)
{
  while(true)
  {
    printMap(board);
//Prints out menu
    cout << "What would you like to do?" << endl;
    cout << "1. Search North\n2. Search East\n3. Search South\n4. Search West" << endl;
    cout << "5. See Map\n6. Exit" << endl;
    int choice = 0;
//Validation of input
    while(choice<1 or choice>6)
    {
      cout << "Enter 1 - 6:" << endl;
      cin >> choice;
      if (cin.peek() == '\n')
	cin.ignore();
    }
//Cases lead to the same function but different parameters
    switch(choice)
    {
    case 1:
//Makes the investigator go north and updates the map
      if(checkSearch(investPositionX,investPositionY-1))
      { 
	board[investPositionY][investPositionX] = '*';
	investPositionY -=1;
	board[investPositionY][investPositionX] = 'I';
      }
      break;
    case 2:
//Makes the investigator go east and updates the map
      if(checkSearch(investPositionX+1,investPositionY))
      {
	board[investPositionY][investPositionX] = '*';
	investPositionX +=1;
	board[investPositionY][investPositionX] = 'I';
      }
      break;
    case 3:
//Makes the investigator go south and updates the map
      if(checkSearch(investPositionX,investPositionY+1))
      {
	board[investPositionY][investPositionX] = '*';
	investPositionY +=1;
	board[investPositionY][investPositionX] = 'I';
      }
      break;
    case 4:
//Makes the investigator go west and updates the map
      if(checkSearch(investPositionX-1,investPositionY))
      {
	board[investPositionY][investPositionX] = '*';
	investPositionX -=1;
	board[investPositionY][investPositionX] = 'I';
      }
      break;
    case 5:
//Prints the map again
      printMap(board);
      break;
    case 6:
//Exits the program
      cout << "Giving up so soon?\nGoodbye." << endl;
      exit(1);
      break;
    }
//Determines if the investigator found the target and either exits or continues the program
    if (checkWin(investPositionX,investPositionY,targetPositionX,targetPositionY))
    {
      cout << "You found the target." << endl;
      exit(1);
    }
    recommendation(investPositionX,investPositionY,targetPositionX,targetPositionY);
  }
}

bool checkWin(int investPositionX, int investPositionY,int targetPositionX,
	      int targetPositionY)
{
  if((investPositionX==targetPositionX) and (investPositionX==investPositionY))
    return true;
  return false;
}

bool checkSearch(int investPositionX, int investPositionY)
{
//Checks to see if the user wants the investigator to go out of the map
  if((investPositionX>9 or investPositionX<0)or(investPositionY>9 or investPositionY<0))
  {
    cout << "You cannot go this direction." << endl;
    return false;
  }
  return true;
}

void recommendation(int investPositionX, int investPositionY,int targetPositionX,
		    int targetPositionY)
{
//Uses the difference between the investigator's x or y position and the x or y position
//of the target to determine what course the investigator should take. Determines based on 
//x position first, then y. 
  if(investPositionX > targetPositionX)
    cout << "Try Searching West" << endl;
  else if(investPositionX < targetPositionX)
    cout << "Try Searching East" << endl;
  else if(investPositionY < targetPositionY)
    cout << "Try Searching South" << endl;
  else if(investPositionY > targetPositionY)
    cout << "Try Searching North" << endl;
}
